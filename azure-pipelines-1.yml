trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

stages:
- stage: 'Production'
  jobs:
  - deployment: 'DeployToProduction'
    environment: 'Development'
    strategy:
        runOnce:
          deploy:
            steps:
            - task: DownloadBuildArtifacts@0
              inputs:
                buildType: 'current'
                downloadType: 'single'
                artifactName: 'drop'
                downloadPath: '$(System.DefaultWorkingDirectory)'
            - task: AzureResourceManagerTemplateDeployment@3
              inputs:
                deploymentScope: 'Resource Group'
                azureResourceManagerConnection: '<subscription-connection-name>'
                subscriptionId: '<subscriptiont-id>'
                action: 'Create Or Update Resource Group'
                resourceGroupName: 'erwin-prod'
                location: 'West Europe'
                templateLocation: 'Linked artifact'
                csmFile: '$(System.DefaultWorkingDirectory)/drop/templates/api.json'
                csmParametersFile: '$(System.DefaultWorkingDirectory)/drop/templates/api.prod.json'
                deploymentMode: 'Incremental'
